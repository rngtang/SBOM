import {useState, useEffect} from 'react'
import * as React from 'react'
import styles from './Vulnerability.module.css';
import sbom1 from '../data/vuln.json';

const Intro = ({sbomId}) => {
    const [vulns, setVulns] = useState([])
    // const sbomsUrl = 'http://localhost:8080/sboms/1/vulnerabilities'; //vulnerabilities are associated w/ sbom 
    const sbomsUrl = `http://localhost:8080/sboms/${sbomId}/vulnerabilities`;

    const fetchVulns = () => {
        fetch(sbomsUrl)
            .then((response) => response.json())
            .then((data) => {
                console.log(data);
                setVulns(data);
            })
    }
    
    useEffect(() => {
        fetchVulns();
        console.log("getting all vulnerabilities for sbom 1");
    }, [])


    return (
        <>
            {
                vulns.map((vuln => {
                    return (
                        <>
                        <div className={styles.section}>
                          {vuln.id && <p key={`id-${vuln.id}`}><strong>Current Vulnerability: </strong>{vuln.id}</p>}
                          {vuln.description && <p key={`description-${vuln.description}`}><strong>{vuln.description}</strong></p>}
                          {<p>---</p>}
                          {vuln.vulnID && <p key={`vulnID-${vuln.vulnID}`}><strong>Vulnerability ID: </strong>{vuln.vulnID}</p>}
                          {vuln.affected && <p key={`affected-${vuln.affected}`}><strong>Package(s): </strong>{vuln.affected.join(", ")}</p>}
                          {vuln.sources[0].name && <p key={`source_name-${vuln.sources[0].name}`}><strong>Source: </strong>{vuln.sources[0].name}</p>}
                          {vuln.sources[0].url && <p key={`source_url-${vuln.sources[0].url}`}><strong>Source Link </strong> - visit this link to learn more: <a href={vuln.sources[0].url} target="_blank" style={{ color: 'var(--dukeblue)' }}> {vuln.sources[0].url}</a></p>}
                          {vuln.ratings[0].severity && <p key={`ratings_severity-${vuln.ratings[0].severity}`}><strong>Severity: </strong>{vuln.ratings[0].severity}</p>}
                          {vuln.recommendation && <p key={`recommendation-${vuln.recommendation}`}><strong>Recommended Action: </strong><a href={vuln.recommendation} target="_blank" style={{ color: 'var(--dukeblue)' }}> {vuln.recommendation}</a></p>}
                        </div>
                        </>
                      ); 
                }))
            }
        </>
    )
}

const Vulnerability = (sbomId) => {
    return (
        <>
            <Intro sbomId={1}/>
        </> 
    );
};

export default Vulnerability;
