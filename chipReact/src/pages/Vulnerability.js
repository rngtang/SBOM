import { useState, useEffect } from 'react'
import * as React from 'react'
import  styles from './Vulnerability.module.css';
import { useNavigate, useLocation } from 'react-router-dom';
import { Button } from 'react-bootstrap';
import { style } from 'd3';

const Intro = ({sbomId, sbomName, sbomDesc}) => {
    const [vulns, setVulns] = useState([]);
    const navigate = useNavigate();
    const sbomsUrl = `http://localhost:8080/sboms/${sbomId}/vulnerabilities`;

    // create a handle for fetching vulnerabillities 
    const fetchVulns = () => {
        fetch(sbomsUrl)
            .then((response) => response.json())
            .then((data) => {
                // debugger line
                // console.log(data);
                setVulns(data);
            })
    }

    useEffect(() => {
        fetchVulns();
        // console.log("getting all vulnerabilities for sbom 1");
    }, [])

    const handleButtonClick = () => {
        navigate('/viewSBOMs');
    }


    return (
        <>
        <div className={styles.header}>
            <Button type='submit'className={styles.button} onClick={handleButtonClick}>
                &#8592; Go back to all SBOMs 
            </Button>
            <div className={styles.namedesc}>
                <p><strong>SBOM Name: </strong> {sbomName}</p>
                <p><strong>SBOM Description: </strong> {sbomDesc}</p>
            </div>
        </div>

            {
                vulns.map((vuln => {
                    return (
                        <>
                            <div className={styles.section}>
                                {vuln.id && vuln.description && <h3 key={`id_description-${vuln.id}`} className={styles.h3}><strong> {vuln.id}: {vuln.description}</strong></h3>}
                                {<p></p>}
                                {vuln.vulnID && <p key={`vulnID-${vuln.vulnID}`}><strong>Vulnerability ID: </strong>{vuln.vulnID}</p>}
                                {vuln.affected && <p key={`affected-${vuln.affected}`}><strong>Affected Package(s): </strong>{vuln.affected.join(", ")}</p>}
                                {vuln.sources[0].name && <p key={`source_name-${vuln.sources[0].name}`}><strong>Source: </strong>{vuln.sources[0].name}</p>}
                                {vuln.sources[0].url && <p key={`source_url-${vuln.sources[0].url}`}><strong>Source Link </strong> - visit here to learn more: <a href={vuln.sources[0].url} target="_blank" style={{ fontWeight: 'bold', color: 'var(--dukeblue)' }}> {vuln.sources[0].url}</a></p>}
                                {vuln.ratings[0].severity && <p key={`ratings_severity-${vuln.ratings[0].severity}`}><strong>Severity: </strong>{vuln.ratings[0].severity}</p>}
                                {vuln.recommendation && <p key={`recommendation-${vuln.recommendation}`}><strong>Recommended Action: </strong> - visit here to learn more: <a href={vuln.recommendation} target="_blank" style={{ fontWeight: 'bold', color: 'var(--dukeblue)' }}> {vuln.recommendation}</a></p>}
                            </div>
                        </>
                    );
                }))
            }
        </>
    );
}

const Vulnerability = () => {
    const location = useLocation();
    const sbomId = location?.state?.sbomId;
    const sbomName = location?.state?.sbomName;
    const sbomDesc = location?.state?.sbomDesc;

    return (
        <>
            <Intro sbomId={sbomId} sbomName={sbomName} sbomDesc={sbomDesc}/>
        </>
    );
};

export default Vulnerability;